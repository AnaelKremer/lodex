prepend = delegate?file=../worker.ini
mimeType = text/csv
type = file
label = ris

[use]
plugin = basics
plugin = lodex

[env]
path = source
value = fix('http://purl.org/ontology/bibo/authorList', 'http://purl.org/ontology/bibo/abstract', 'http://purl.org/dc/terms/title', 'https://data.istex.fr/ontology/istex#publicationTitle', 'http://purl.org/dc/terms/publisher', 'http://purl.org/dc/terms/language', 'http://purl.org/dc/terms/issued', 'http://purl.org/ontology/bibo/doi', 'http://purl.org/dc/terms/subject', 'https://data.istex.fr/ontology/istex#contentType', 'https://data.istex.fr/ontology/istex#accessURL', 'http://www.w3.org/2004/02/skos/core#note')

path = target
value = fix('AU', 'AB', 'TI', 'T2', 'ED', 'LA', 'PY', 'DO', 'KW', 'M3', 'L2', 'N1')

[buildContext]
connectionStringURI = get('connectionStringURI')

[env]
path = from
value = get('fields').map('name')

path = to
value = get('fields').map('scheme')

[LodexRunQuery]

[greater]
path = total
than = 1

[filterVersions]
[filterContributions]

[keyMapping]
from = env('from')
to = env('to')

[keyMapping]
from = env('source')
to = env('target').map(i => i.concat('  -'))

[exchange]
value = self() \
    .map((value, key) => [key, value]) \
    .filter(item => String(item[0]).includes('-')) \
    .filter(item => item[1]) \
    .flatMap(item => _.castArray(item[1]).map(elem => item[0].concat(' ').concat(elem.trim()))) \
    .unshift("TY  - GENERIC") \
    .concat(["ER  -"]) \
    .join("\n").concat("\n\n")

[ungroup] 

# TODO : TY could be different of "GENERIC"
